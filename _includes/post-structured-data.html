{% capture meta_url %}{{page.url | replace:'index.html','' | prepend:site.baseurl | prepend: site.url}}{% endcapture %}

{% if page.image %}
{% assign page_image = page.image | prepend:site.baseurl | prepend: site.url %}
{% else %}
{% assign page_image = site.logo | prepend:site.baseurl | prepend: site.url %}
{% endif %}
{% capture meta_image %}{{page_image}}{% endcapture %}

{% if page.title %}
{% assign page_title = page.title %}
{% else %}
{% assign page_title = site.name %}
{% endif %}
{% capture meta_title %}{{page_title | markdownify | strip_html | strip_newlines | escape_once}}{% endcapture %}

{% if page.title %}
{% assign page_title = page.title %}
{% else %}
{% assign page_title = site.name %}
{% endif %}
{% capture meta_title %}{{page_title | markdownify | strip_html | strip_newlines | escape_once}}{% endcapture %}

{% if page.description %}
{% assign page_description = page.description %}
{% elsif page.excerpt %}
{% assign page_description = page.excerpt %}
{% else %}
{% assign page_description = site.description %}
{% endif %}
{% capture meta_description %}{{page_description | strip_html | xml_escape | normalize_whitepace | strip_newlines | strip | truncate: 200 }}{% endcapture %}

{% if page.categories %}
{% assign page_categories = page.categories %}
{% else %}
{% assign page_categories = site.keywords %}
{%endif %}
{% capture meta_categories %}{{page_categories | join: ', ' | escape}}{% endcapture %}

{% if page.tags %}
{% assign page_keywords = page.tags %}
{% else %}
{% assign page_keywords = site.keywords %}
{%endif %}
{% capture meta_keywords %}{{page_keywords | join: ', ' | escape}}{% endcapture %}

{% if page.date %}
{% assign page_publish_date = page.date %}
{%endif %}
{% capture meta_publish_date %}{{page_publish_date | date_to_xmlschema}}{% endcapture %}

{% if page.last_modified_at %}
{% assign page_modified_date = page.last_modified_at %}
{% else %}
{% assign page_modified_date = page.date %}
{%endif %}
{% capture meta_modified_date %}{{page_modified_date | date_to_xmlschema}}{% endcapture %}

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "@id": "{{meta_url}}",
    "url": "{{meta_url}}",
    "headline": "{{meta_title}}",
    "description": "{{meta_description}}",
    "datePublished": "{{meta_publish_date}}",
    "genre": "{{meta_categories}}",
    "keywords": "{{meta_keywords}}",
    "wordCount": "{{wordcount}}",
    "articleBody": "{{ page.content | strip_html | xml_escape | normalize_whitepace | strip_newlines | strip }}",
    "image": {
      "@type": "ImageObject",
      "url": "{{meta_image}}"
    },
    "author": {
      "@type": "Person",
      "name": "Jayesh Panchal",
      "sameAs": [
        "https://twitter.com/codetonics",
        "https://github.com/codetonics"
      ]
    },
    "publisher": {
      "@type": "Organization",
      "name": "Codetonics",
      "sameAs": [
        "https://twitter.com/codetonics",
        "https://github.com/codetonics"
      ],
      "logo": {
        "@type": "ImageObject",
        "url": "{{site.logo | prepend:site.baseurl | prepend: site.url}}"
      }
    },
    "mainEntityOfPage": {
      "@type": "BlogPosting",
      "@id": "{{meta_url}}"
    }
  }
</script>